# 18章 SREにおかえるソフトウェアエンジニアリング
## 18.1 SRE内でのソフトウェアエンジニアリングの重要性
- SREは内部的なソフトウェアを効率的に開発できるユニークなポジション
  - Googleのプロダクトに関して詳しいので、ソフトウェアの設計や作成を行える。
  - 普段からプロダクション環境を動作扠せ続けるためのツールを開発しているので、要求、必要事項を理解可能。
  - ユーザは同僚のSREはのため、フィードバックが受けやすく、最小限の機能であっても理解を示してくれる。
- SREの原則の1つ「チームの大きさがサービスの成長と直接的に結びついて大きくなってはならない」
  - 日々の運用の非効率な部分を改善する必要がある。
- コーディングスキルを発揮する場をもたらす。

## 18.2 Auxonのケーススタディ : プロジェクトの背景と問題の領域
- Auxonとは
  - Googleのプロダクション環境で動作するサービスのためのキャパシティプランニングを自動化するツール
  - サービスのリソースの要求と依存関係をインテントベースで記述したものを収集する手段を提供するプロダクト。
- キャパシティプランニングとは
  - システムのサービスレベル要求やサービス需要などから、システムのリソースや性能などを見積もり、最適なシステムの開発・増強の計画を作成すること

### 18.2.1 旧来のキャパシティブランニング
- サイクル
  1. 需要予測の収集
  2. 構築と割り当ての計画立案
  3. 計画のレビューと承認
  4. リソースのデプロイと設定
- サイクルに終わりはない。
- 変化が生じるたびに人手で調整されていた。
- 本質的な不安定さ
  - わずかな修正であっても計画全てをチェックして実行可能か確認する必要がある。
  - 大規模な遅れはゼロから計画を作り直す必要がある。
  - ある時期の計画変更は以降の計画を更新する必要がある。
- 手間がかかる上に不明瞭
  - 計画を立てるための情報を集めるのは手間がかかる上に、立てられた結果に関しても大まかなものでしかない。

### 18.2.2 Googleにおけるソリューション : インテントベースのキャパシティプランニング
- 実装ではなく、要求を指定する。
- インテントベースのキャパシティプランニングというアプローチに移行した。
- インテントとは
  - サービスの要求の依存関係とパラメータ。
  - サービスの担当者がサービスをどのように動作させたいかを示す。
- インテントをコード化して、サービスへのクラスタとリソースの割り当てを決めた計画を自動生成する。
- 人はSLO、プロダクション環境の依存関係、インフラストラクチャの要求など優先度の高い事項に集中できる。
- コンピュータなので精度が高いのでコスト削減可能。

## 18.3 インテントベースのキャパシティプランニング
1. 「Fooというサービス用に、クラスタX,Y,Zに50コアが欲しい」
  - なぜ、このリソースがこのクラスタ内に必要？
2. 「Fooというサービス用にYYYリージョンのどれか3つのクラスタに50コアが欲しい」
  - なぜ、このリソースが3箇所に必要？
3. 「Fooというサービスの需要を各地理的リージョン内で満たし、N + 2の冗長性を確保したい」
  - なぜFooというサービスにはN + 2の冗長性が必要？
4. 「Fooというサービスを、5ナインの信頼性で動作させたい」

---

- 3を超えるともっとも成功できる。
  - 十分な柔軟性が得られるとともに、リクエストがもたらす結果は高レベルかつ理解しやすい言葉で表現されている。
- 洗練されたサービスの場合には4を目指すと良い

### 18.3.1 インテントを示すもの
- 依存関係
- パフォーマンスメトリクス
  - Nのクエリを処理するにはどれだけのリソースが必要か？など
  - FooがNのクエリを処理するとBaraのデータは何Mbpsになるか？など
- 優先順位付け

### 18.3.2 Auxonの紹介
- Auxonとは（2回目）
  - Googleのプロダクション環境で動作するサービスのためのキャパシティプランニングを自動化するツール
  - サービスのリソースの要求と依存関係をインテントベースで記述したものを収集する手段を提供するプロダクト。
- 要求
  - このサービスは大陸ごとにN + 2でなければならない
  - フロントエンドサーバはバックエンドサーバから50msいないでなければならない
- ↑の要求を受取り、リソースの割当計画を策定する。

### 18.3.3 要求と実績 : 成功と学んだこと
- ローンチ & イテレート
  - 新しいものをリリースしてはフィードバックをもらって改善するというサイクルを繰り返すやり方。
- 完全な設計になるまで動かないのはNG。
- 不確実な領域が出てきたら柔軟に設計しておいて作り直しのコストが大きくならないようにして進める。
- しかし、現実に即した実装にしておくことで地に足をつけておく必要がある。

### 18.3.4 認知の向上と採用の推進
- 内部的なツールを多くの対象者に普及させるには以下が必要
  1. 継続的で一貫性のあるアプローチ。
  2. ユーザによる支持。
  3. シニアエンジニアや管理層による支援。（プロダクトの有用性を理解している前提。）
- 期待値の管理
  - 即座にメリットが得られる。（手作業より楽）
  - 設定ファイルの互換性
- 適切なユーザの発見
  - 1つのソリューションですべてをまかなうことはできない。
  - 既存のツールを使用していないチームへのアプローチからスタートする。
  - ユーザ自身が広めてくれる。
- ユーザに対するサポート
  - アーリーアダプタに対し、きめ細かいユーザサポートの提供。
  - 後の採用者達はアーリーアダプタが満足している様子を見て安心してくれる。
  - アーリーアダプタが他のチームに対してサポートを行ってくれる。
- 適切レベルでの設計
  - 社内全体で100%使われることなどない。
  - 汎用的に作る。

### 18.3.5 チームの力学
- 経験の多様性は盲点をなくすと共に、すべてのチームのユースケースが自分のチームのユースケースと同じと思いこむ事から避けられる。
- スペシャリストのチームへの参画のガイドラインとしてはプロジェクトの離陸はうまくいったと示せており、専門知識によってチームスキルが大きく強化できるようなタイミング。

## 18.4 SREにおけるソフトウェアエンジニアリングの推進
- プロジェクトが単発のツールから完全なソフトウェアエンジニアリングの対象へと飛躍する良い候補として見なされるためには何が必要なのか？
  - ちょっと何言ってるかわかんないです。。。😇
- 1つのサービスにフォーカスしすぎると汎用化に失敗するが、汎用的すぎるツールはそのユースケースにもうまく適用できなくなり価値が不十分なものになってしまう。

### 18.4.1 SREにおけるソフトウェアエンジニアリング文化の構築と成功 : 採用と開発期間
- SREはゼネラリストが多い。
  - 深さよりも幅優先で学びたい。
- SREで開発されたプロダクトを開発する場合においても、SREに組み込まれたフルタイムの開発者ではなくSREとして働く事が大事。

### 18.4.2 達成
- SRE組織にソフトウェア開発のモデルをどのように導入するか。
- 組織としての挑戦と捉える必要がある。
- 明確なメッセージの作成と発信
  - その作業から得ることになるメリットを定義し、知らせることが重要。
- 組織の機能の評価
  - 自社内で必要なスキルを持っている人の力を借りる。
- ローンチ & イテレート（2回目）
  - 新しいものをリリースしてはフィードバックをもらって改善するというサイクルを繰り返すやり方。
- 基準は下げない
  - 安易に近道を選ばない。
  - ソフトウェア開発の取り組みに対する信頼を構築するには長い時間がかかるが、過ちを犯して信頼を失うのは一瞬。

## 18.5 まとめ
- SREがソフトウェア開発に時間を割くことのメリットは最終的に会社そのもの、SRE組織、SRE組織自身が享受することになる。
